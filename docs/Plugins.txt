Plugins
=======

*Plugins* are used to "deliver" `Extension Points`_, contributions to extension
points, and Services_ into an Envisage application. In fact, plugins can be
thought of as simply being "delivery trucks" -- they rarely (if ever) do any
*real* work themselves. In other words, plugins can do 3 things:

1) Declare extension points
2) Make contributions to extension points (including its own)
3) Create and publish services

Plugins are located and managed by the *plugin manager*, and, whilst Envisage
is designed such that you can write your own plugin manager, by default, it
uses an implementation based on `Python Eggs`_.

Creating a Plugin
-----------------

All plugins must implement the IPlugin_ interface (an easy way to acheive this
is to subclass the base Plugin_ class), and should provide the following
"housekeeping" information:

- a globally unique identifier (e.g., "acme.motd")

  This obviously allows Envisage to identify a particular plugin in a sea of
  other plugins. Technically, this identifier only need be unique within your
  application, but since the intent is for applications to be able to include
  plugins from (potentially) all over the world, using the common reverse
  domain name notation is probably a good idea!

- a name

  This name should be suitable for display to the user.

- a description

  A nice description of the intent and features of your plugin.

- a list of the plugins required by this plugin

  Envisage uses this to start the plugins in the appropriate order (i.e., if
  plugin A requires plugin B, then plugin B will be started first). This is
  useful for example, if Plugin A requires a service that is started by
  Plugin B.

Here is a snippet from the `acme.motd`_ plugin that is part of the `Message of
the Day`_ example::

    class MOTDPlugin(Plugin):
        """ The 'Message of the Day' plugin """

        #### 'IPlugin' interface ##############################################

        id          = 'acme.motd'
        name        = 'MOTD'
        description = 'The ACME Message of the Day (MOTD) Plugin'
        requires    = []

Plugin Lifecyle
---------------

Plugins have a lifecycle in the context of an application. There are currently
two key lifecycle methods on the IPlugin_ interface:

::

    def start(self, application):
        """ Start the plugin.

        Can be called manually, but is usually called exactly once when the
        application starts.

        """

    def stop(self, application):
        """ Stop the plugin.

        Can be called manually, but is usually called exactly once when the
        application exits.

        """

The start() method is where the implementation creates and registers the 
services it offers, and stop() is where it unregisters them and performs any
other necessary cleanup.

Envisage calls the start() method when the application is being started up,
and as mentioned previously, plugins are started in the order defined by
their requirements clauses.

In the `Message of the Day`_ example, the acme.motd_ plugin creates a MOTD_
object and registers it as a service in its start() method:

::

        def start(self, application):
            """ Start the plugin. """

            # Use the contributed messages to populate a MOTD object.
            motd = MOTD(messages=self.messages)
        
            # Publish the object as a service.
            self._motd_service_id = application.register_service(IMOTD, motd)
        
	    ...

Being a good citizen, it cleans up after itself in the stop() method:

::

        def stop(self, application):
            """ Stop the plugin. """

            # Unregister the MOTD service.
            application.unregister_service(self._motd_service_id)
        
	    return

.. _acme.motd: ../../examples/MOTD/src/acme.motd/setup.py
.. _acme.motd.software_quotes: ../../examples/MOTD/src/acme.motd.software_quotes/setup.py
.. _`Extension Points`: ExtensionPoints.html
.. _IPlugin: ../../enthought/envisage/i_plugin.py
.. _`Message of the Day`: ../../examples/MOTD
.. _MOTD: ../../examples/MOTD/src/acme.motd/acme/motd/motd.py
.. _MOTDPlugin: ../../examples/MOTD/acme.motd/acme/motd/motd_plugin.py
.. _Plugin: ../../enthought/envisage/plugin.py
.. _`Python Eggs`: http://peak.telecommunity.com/DevCenter/PythonEggs
.. _Services: Services.html
